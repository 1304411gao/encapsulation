<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        canvas{
            /*border: 1px solid pink;*/
            margin: 100px auto;
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas"></canvas>
</body>
<script src="js/loading.js"></script>
<script>
    window.onload = function(){
        loadFn({
            loadImg: {
                i1: "img/img1.jpg",
                i2: "img/img2.jpg",
                i3: "img/img3.jpg",
            },
            complete:init
        });
        
        function init(_imgs) {
            const imgs = [_imgs.i1, _imgs.i2];
            console.log(_imgs);
            const canvas = document.getElementById("myCanvas");
            canvas.width = 1920 / 3;
            canvas.height = 1080 / 3;
            const ctx = canvas.getContext("2d");

            //定义常用变量
            let cw = canvas.width, //canvas宽度
                ch = canvas.height, //canvas高度
                s = 10, //将高度分割的份数
                img1 = _imgs.i1, //要绘制的图片对象
                imgNum = 3; //图片合成数


            for(let i = 0; i < s; i++){
                // ctx.drawImage(img1, 0, img1.height/s*i, img1.width/imgNum, img1.height/s, 0, ch/s*i, cw, ch/s);
            }

            function test(_index){
                console.log("test执行");
                let time = 0;
                let tiemr = setInterval(function(){
                    time ++;
                    // if(time == 20){
                    //     clearInterval(tiemr);
                    //     for(let i = 0; i < s; i++) {
                    //         ctx.drawImage(img1, img1.width /imgNum*_index, img1.height / s * i, img1.width / imgNum, img1.height / s, 0, ch / s * i, cw, ch / s);
                    //     }
                    //
                    //     return false;
                    // }
                    // for(let i = 0; i < s; i++){
                    //     let r = (randomFn((imgNum-1)*100, 0))/100;
                    //     ctx.drawImage(img1, img1.width/imgNum*r, img1.height/s*i, img1.width/imgNum, img1.height/s, 0, ch/s*i, cw, ch/s);
                    // }

                    ctx.clearRect(0,0,cw,ch);
                    for(let i = 0; i < s; i++){
                        let nowImg = imgs[0];
                        let r = randomFn(200, -200);
                        if(time > 10 && time < 20){
                            nowImg = imgs[randomFn(1, 0)];
                        }else if(time > 20){
                            nowImg = imgs[1];
                        }
                        if(time >= 30){
                            ctx.drawImage(nowImg, 0, img1.height/s*i, img1.width, img1.height/s, 0, ch/s*i, cw, ch/s);
                            clearInterval(tiemr);
                        }else{
                            ctx.drawImage(nowImg, 0 + r, img1.height/s*i, img1.width, img1.height/s, 0, ch/s*i, cw, ch/s);
                        }

                    }
                },20);

            }

            document.onclick = function(){

                test(randomFn(imgNum-1, 0));
            }
        }
    }

    //随机数函数
    function randomFn(max,min){
        return parseInt(Math.random()*(max - min + 1)+min);
    }
</script>
</html>